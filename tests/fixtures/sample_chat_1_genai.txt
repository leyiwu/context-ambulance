USER: I'm building a React component that fetches user data and displays it. Here's my code:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data));
  });
  
  return <div>{user?.name}</div>;
}
```

But it's causing infinite re-renders. Can you help?

ASSISTANT: The issue is that your useEffect doesn't have a dependency array, so it runs after every render. This creates an infinite loop because setting state causes a re-render.

Try this:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data));
  }, []); // Add empty dependency array
  
  return <div>{user?.name}</div>;
}
```

USER: Now it only fetches once and doesn't update when userId changes!

ASSISTANT: I apologize for the oversight. You need to include userId in the dependency array:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data));
  }, [userId]); // Include userId
  
  return <div>{user?.name}</div>;
}
```

USER: Great! But now I'm getting a warning about missing error handling.

ASSISTANT: Let me add error handling:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data))
      .catch(err => setError(err));
  }, [userId]);
  
  if (error) return <div>Error: {error.message}</div>;
  return <div>{user?.name}</div>;
}
```

USER: Now I'm getting "Cannot read property 'message' of undefined" sometimes.

ASSISTANT: I apologize for the confusion. Let me fix that:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data))
      .catch(err => setError(err.message));
  }, [userId]);
  
  if (error) return <div>Error: {error}</div>;
  return <div>{user?.name}</div>;
}
```

USER: Still getting the same error!

ASSISTANT: I apologize. Let me try a different approach:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    fetch(`/api/users/${userId}`)
      .then(res => res.json())
      .then(data => setUser(data))
      .catch(err => setError(err?.message || 'Unknown error'));
  }, [userId]);
  
  if (error) return <div>Error: {error}</div>;
  return <div>{user?.name}</div>;
}
```

USER: The error still appears randomly!

ASSISTANT: I see the issue now. Let me rewrite this completely:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const fetchUser = async () => {
      try {
        const res = await fetch(`/api/users/${userId}`);
        const data = await res.json();
        setUser(data);
      } catch (err) {
        setError(err.message);
      }
    };
    
    fetchUser();
  }, [userId]);
  
  if (error) return <div>Error: {error}</div>;
  return <div>{user?.name}</div>;
}
```

USER: Same issue! The error is still undefined sometimes.

ASSISTANT: I apologize for not catching this earlier. The problem is that we need to handle the case where err might not have a message property:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [error, setError] = useState(null);
  
  useEffect(() => {
    const fetchUser = async () => {
      try {
        const res = await fetch(`/api/users/${userId}`);
        const data = await res.json();
        setUser(data);
      } catch (err) {
        setError(String(err));
      }
    };
    
    fetchUser();
  }, [userId]);
  
  if (error) return <div>Error: {error}</div>;
  return <div>{user?.name}</div>;
}
```

USER: This is frustrating. Can you just show me the correct way to handle this?

ASSISTANT: I apologize for the confusion. Here's the correct implementation:

```jsx
function UserProfile({ userId }) {
  const [user, setUser] = useState(null);
  const [error, setError] = useState(null);
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    const fetchUser = async () => {
      setLoading(true);
      try {
        const res = await fetch(`/api/users/${userId}`);
        if (!res.ok) throw new Error('Failed to fetch');
        const data = await res.json();
        setUser(data);
        setError(null);
      } catch (err) {
        setError(err instanceof Error ? err.message : 'An error occurred');
        setUser(null);
      } finally {
        setLoading(false);
      }
    };
    
    fetchUser();
  }, [userId]);
  
  if (loading) return <div>Loading...</div>;
  if (error) return <div>Error: {error}</div>;
  return <div>{user?.name}</div>;
}
```